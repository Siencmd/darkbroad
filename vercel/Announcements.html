<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Announcements - Darkboard</title>
    <link rel="stylesheet" href="Darkboard.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
    />
  </head>
  <body>
    <!-- Main Navigation - Horizontal for All -->
    <nav class="main-nav" role="navigation" aria-label="Main navigation">
      <div class="nav-header">
        <a href="index.html" class="brand">DARKBOARD</a>
      </div>
      <ul class="nav-list">
        <li><a href="index.html" class="nav-item"><i class="fas fa-th-large"></i><span>Dashboard</span></a></li>
        <li><a href="Subjects.html" class="nav-item"><i class="fas fa-book"></i><span>Subjects</span></a></li>
        <li><a href="Grades.html" class="nav-item"><i class="fas fa-chart-bar"></i><span>Grades</span></a></li>
        <li><a href="Schedule.html" class="nav-item"><i class="fas fa-calendar-alt"></i><span>Schedule</span></a></li>
        <li><a href="Announcements.html" class="nav-item active"><i class="fas fa-bell"></i><span>Announcements</span></a></li>
        <li><a href="Submissions.html" class="nav-item"><i class="fas fa-file-upload"></i><span>Submissions</span></a></li>
        <li><a href="Profile.html" class="nav-item"><i class="fas fa-user"></i><span>Profile</span></a></li>
        <li><a href="Settings.html" class="nav-item"><i class="fas fa-cog"></i><span>Settings</span></a></li>
        <li><a href="Help.html" class="nav-item"><i class="fas fa-question-circle"></i><span>Help</span></a></li>
        <li><a href="#" id="logoutBtn" class="nav-item"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a></li>
      </ul>
      <div class="nav-right">
        <div class="user-menu-right">
          <img src="Gemini_Generated_Image_g3iakg3iakg3iakg.png" alt="User avatar" class="user-avatar">
          <span id="headerUserName">Loading...</span>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="content">
      <div class="welcome-section">
        <div class="welcome-text">
          <h1>Announcements</h1>
          <p>Stay updated with the latest news and announcements.</p>
        </div>
      </div>

      <!-- Announcements List -->
      <div class="announcements-list">
        <div class="card announcement-card">
          <div class="announcement-header">
            <div class="announcement-icon">
              <i class="fas fa-graduation-cap"></i>
            </div>
            <div class="announcement-meta">
              <span class="announcement-date">February 10, 2026</span>
              <span class="announcement-category">Academic</span>
            </div>
          </div>
          <h3>Midterm Examinations Schedule</h3>
          <p>The midterm examination schedule has been released. Please check your email for detailed information regarding your exam dates and times.</p>
          <div class="announcement-footer">
            <span class="announcement-author">Posted by: Registrar's Office</span>
            <button class="btn-read-more">Read More</button>
          </div>
        </div>

        <div class="card announcement-card">
          <div class="announcement-header">
            <div class="announcement-icon">
              <i class="fas fa-calendar-check"></i>
            </div>
            <div class="announcement-meta">
              <span class="announcement-date">February 8, 2026</span>
              <span class="announcement-category">Events</span>
            </div>
          </div>
          <h3>Tech Innovation Week 2026</h3>
          <p>Join us for Tech Innovation Week featuring workshops, hackathons, and guest speakers from leading tech companies. Register now!</p>
          <div class="announcement-footer">
            <span class="announcement-author">Posted by: Student Council</span>
            <button class="btn-read-more">Read More</button>
          </div>
        </div>

        <div class="card announcement-card">
          <div class="announcement-header">
            <div class="announcement-icon">
              <i class="fas fa-book"></i>
            </div>
            <div class="announcement-meta">
              <span class="announcement-date">February 5, 2026</span>
              <span class="announcement-category">Resources</span>
            </div>
          </div>
          <h3>Library Extended Hours</h3>
          <p>The library will be open 24/7 during midterm week. Quiet study areas are now available on the 3rd floor.</p>
          <div class="announcement-footer">
            <span class="announcement-author">Posted by: Library Services</span>
            <button class="btn-read-more">Read More</button>
          </div>
        </div>

        <div class="card announcement-card">
          <div class="announcement-header">
            <div class="announcement-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="announcement-meta">
              <span class="announcement-date">February 3, 2026</span>
              <span class="announcement-category">Club</span>
            </div>
          </div>
          <h3>New Student Organizations</h3>
          <p>Three new student organizations have been approved: AI Club, Game Development Society, and Cybersecurity Group. Join today!</p>
          <div class="announcement-footer">
            <span class="announcement-author">Posted by: Student Affairs</span>
            <button class="btn-read-more">Read More</button>
          </div>
        </div>
      </div>
    </main>

    <script type="module" src="firebase.js"></script>
    <script type="module" src="script.js"></script>
    <script type="module">
      import { logout } from "./script.js";
      import { auth, db } from "./firebase.js";
      import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
      import { doc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
      
      const logoutBtn = document.getElementById("logoutBtn");
      logoutBtn.addEventListener("click", (e) => logout(e));
      
      let profileRealtimeUnsubscribe = null;

      function updateHeaderName() {
        const userData = JSON.parse(localStorage.getItem('userData') || '{}');
        const headerUserName = document.getElementById('headerUserName');
        if (headerUserName) {
          headerUserName.textContent = userData.name || 'User';
        }
      }

      function setupProfileRealtime() {
        onAuthStateChanged(auth, (user) => {
          if (!user) return;

          if (typeof profileRealtimeUnsubscribe === 'function') {
            profileRealtimeUnsubscribe();
            profileRealtimeUnsubscribe = null;
          }

          profileRealtimeUnsubscribe = onSnapshot(doc(db, 'users', user.uid), (userSnap) => {
            if (!userSnap.exists()) return;
            const profile = userSnap.data() || {};
            const localUser = JSON.parse(localStorage.getItem('userData') || '{}');
            const merged = {
              ...localUser,
              id: user.uid,
              name: profile.fullName || localUser.name || user.displayName || 'User',
              role: profile.role || localUser.role,
              course: profile.course || localUser.course
            };
            localStorage.setItem('userData', JSON.stringify(merged));
            updateHeaderName();
          }, (error) => {
            console.warn('Announcements profile realtime failed:', error?.message || error);
          });
        });
      }

      // Load user data for header
      window.addEventListener('DOMContentLoaded', () => {
        updateHeaderName();
        loadAnnouncements();
        setupProfileRealtime();
      });

      // Keep announcements in sync across tabs/windows.
      window.addEventListener('storage', (event) => {
        if (event.key === 'announcements') {
          loadAnnouncements();
        }
      });

      window.addEventListener('beforeunload', () => {
        if (typeof profileRealtimeUnsubscribe === 'function') {
          profileRealtimeUnsubscribe();
          profileRealtimeUnsubscribe = null;
        }
      });
      
      function loadAnnouncements() {
        const announcementsList = document.querySelector('.announcements-list');
        
        // Get announcements from localStorage
        let announcements = [];
        try {
          announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
          if (!Array.isArray(announcements)) announcements = [];
        } catch (error) {
          announcements = [];
        }
        
        if (announcements.length === 0) {
          // Show empty state message but keep sample announcements
          console.log('No announcements in localStorage, showing defaults');
          return;
        }
        
        // Clear current announcements
        announcementsList.innerHTML = '';
        
        // Render announcements
        announcements.forEach(announcement => {
          const card = document.createElement('div');
          card.className = 'card announcement-card';
          card.innerHTML = `
            <div class="announcement-header">
              <div class="announcement-icon">
                <i class="fas fa-${announcement.icon || 'bell'}"></i>
              </div>
              <div class="announcement-meta">
                <span class="announcement-date">${announcement.date || new Date().toLocaleDateString()}</span>
                <span class="announcement-category">${announcement.category || 'General'}</span>
              </div>
            </div>
            <h3>${announcement.title || 'Untitled'}</h3>
            <p>${announcement.message || announcement.content || ''}</p>
            <div class="announcement-footer">
              <span class="announcement-author">Posted by: ${announcement.author || 'Admin'}</span>
              <button class="btn-read-more">Read More</button>
            </div>
          `;
          announcementsList.appendChild(card);
        });
      }

      document.addEventListener('click', (event) => {
        const button = event.target.closest('.btn-read-more');
        if (!button) return;

        const card = button.closest('.announcement-card');
        const text = card?.querySelector('p');
        if (!text) return;

        const expanded = button.dataset.expanded === 'true';
        if (expanded) {
          text.style.maxHeight = '';
          text.style.overflow = '';
          button.textContent = 'Read More';
          button.dataset.expanded = 'false';
        } else {
          text.style.maxHeight = 'none';
          text.style.overflow = 'visible';
          button.textContent = 'Show Less';
          button.dataset.expanded = 'true';
        }
      });
    </script>
  </body>
</html>
