<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Subjects - Darkboard</title>

    <!-- Main CSS -->
    <link rel="stylesheet" href="Darkboard.css" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"/>

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
    />
  </head>

  <body>
    <div class="app-container">
      <!-- Mobile Sidebar Toggle -->
      <button id="hamburger-btn" class="hamburger-btn">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <!-- Right Side User Menu -->
      <div class="user-menu-right">
        <img src="Gemini_Generated_Image_g3iakg3iakg3iakg.png" alt="User" class="user-avatar">
        <span id="headerUserName">Ace</span>
      </div>

      <!-- Sidebar Navigation -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <a href="index.html" class="brand">DARKBOARD</a>
        </div>
        <nav class="sidebar-nav">
          <a href="index.html" class="nav-item">
            <i class="fas fa-th-large"></i>
            <span>Dashboard</span>
          </a>
          <a href="Subjects.html" class="nav-item active">
            <i class="fas fa-book"></i>
            <span>Subjects</span>
          </a>
          <a href="Grades.html" class="nav-item">
            <i class="fas fa-chart-bar"></i>
            <span>Grades</span>
          </a>
          <a href="Schedule.html" class="nav-item">
            <i class="fas fa-calendar-alt"></i>
            <span>Schedule</span>
          </a>
          <a href="Announcements.html" class="nav-item">
            <i class="fas fa-bell"></i>
            <span>Announcements</span>
          </a>
          <hr style="border: 0; border-top: 1px solid rgba(255, 255, 255, 0.1); margin: 10px 0;" />
          <a href="Profile.html" class="nav-item">
            <i class="fas fa-user"></i>
            <span>Profile</span>
          </a>
          <a href="Settings.html" class="nav-item">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
          </a>
          <a href="Help.html" class="nav-item">
            <i class="fas fa-question-circle"></i>
            <span>Help</span>
          </a>
          <a href="#" id="logoutBtn" class="nav-item">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </a>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <section class="subjects-section">
          <div class="subjects-header">
            <h1>My Subjects</h1>
            <p>Track your school subjects and grades</p>
          </div>

          <!-- Split Layout -->
          <div class="subjects-content-wrapper">
            <!-- Left Sidebar: List -->
            <div class="subjects-sidebar">
              <div class="sidebar-header">
                <h3>Subject List</h3>
                <button id="addSubjectBtn" class="btn-add-mini" title="Add Subject">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
              <div class="subjects-list" id="subjectsList">
                <!-- List items will be injected here -->
              </div>
            </div>

            <!-- Right Panel: Details -->
            <div class="subject-details" id="subjectDetailsPanel">
              <div class="empty-state">
                <i class="fas fa-book-open"></i>
                <p>Select a subject from the list to view details, tasks, assignments, and lessons.</p>
              </div>
            </div>
          </div>
        </section>
      </main>

      <!-- Add Subject Modal -->
      <div class="modal" id="addSubjectModal">
        <div class="modal-content">
          <span class="close" onclick="closeModal('addSubjectModal')">&times;</span>
          <div class="modal-body">
            <h2>Add New Subject</h2>
            <form id="addSubjectForm">
              <div class="form-group">
                <label>Subject Name</label>
                <input type="text" id="newSubjectName" required placeholder="e.g. Mathematics" />
              </div>
              <div class="form-group">
                <label>Teacher</label>
                <input type="text" id="newTeacherName" required placeholder="e.g. Mr. Anderson" />
              </div>
              <div class="form-group">
                <label>Time</label>
                <input type="text" id="newSubjectTime" required placeholder="e.g. 08:00 AM - 09:30 AM" />
              </div>
              <div class="form-group">
                <label>Description</label>
                <textarea id="newSubjectDescription" rows="5" placeholder="Brief description of the subject..."></textarea>
              </div>
              <button type="submit" class="btn-add-subject">
                <i class="fas fa-check"></i> Save Subject
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- Edit Subject Modal -->
      <div class="modal" id="editSubjectModal">
        <div class="modal-content">
          <span class="close" onclick="closeModal('editSubjectModal')">&times;</span>
          <div class="modal-body">
            <h2>Edit Subject</h2>
            <form id="editSubjectForm">
              <input type="hidden" id="editSubjectIndex" />
              <div class="form-group">
                <label>Subject Name</label>
                <input type="text" id="editSubjectName" required />
              </div>
              <div class="form-group">
                <label>Teacher</label>
                <input type="text" id="editTeacherName" required />
              </div>
              <div class="form-group">
                <label>Time</label>
                <input type="text" id="editSubjectTime" required />
              </div>
              <div class="form-group">
                <label>Description</label>
                <textarea id="editSubjectDescription" rows="5"></textarea>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn-save">
                  <i class="fas fa-check"></i> Save Changes
                </button>
                <button type="button" class="btn-delete" id="deleteSubjectBtn">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="firebase.js"></script>
    <script type="module" src="supabase.js"></script>
    <script type="module" src="script.js"></script>
    <script src="https://unpkg.com/scrollreveal"></script>
    <script src="https://unpkg.com/typed.js@3.0.0/dist/typed.umd.js"></script>
    
    <!-- Modal Functions -->
    <script>
      // Modal functions (non-module for immediate availability)
      function openModal(modalId) {
        var modal = document.getElementById(modalId);
        if (modal) {
          modal.style.display = 'block';
        }
      }
      
      function closeModal(modalId) {
        var modal = document.getElementById(modalId);
        if (modal) {
          modal.style.display = 'none';
        }
      }
      
      // Close modal when clicking outside
      window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
          event.target.style.display = 'none';
        }
      };
      
      // Add Subject Modal Handler
      document.getElementById('addSubjectBtn')?.addEventListener('click', function() {
        openModal('addSubjectModal');
      });
      
      document.getElementById('addSubjectForm')?.addEventListener('submit', function(e) {
        e.preventDefault();
        alert('Form submitted! Adding subject...');
        console.log('Add subject form submitted');
        
        var subjects = JSON.parse(localStorage.getItem('subjects')) || [];
        var subject = {
          id: Date.now().toString(),
          name: document.getElementById('newSubjectName').value.trim(),
          teacher: document.getElementById('newTeacherName').value.trim(),
          time: document.getElementById('newSubjectTime').value.trim(),
          description: document.getElementById('newSubjectDescription').value.trim(),
          lessons: [],
          tasks: [],
          assignments: [],
          quizzes: []
        };
        
        subjects.push(subject);
        localStorage.setItem('subjects', JSON.stringify(subjects));
        console.log('Subject added:', subject);
        
        this.reset();
        closeModal('addSubjectModal');
        setTimeout(function() { location.reload(); }, 300);
      });
    </script>
    
    <script type="module">
      import { logout, initializeSubjects } from "./script.js";

      // Initialize subjects page
      if (typeof initializeSubjects === 'function') {
        initializeSubjects();
      }

      // Logout button
      const logoutBtn = document.getElementById("logoutBtn");
      logoutBtn?.addEventListener("click", (e) => logout(e));

      // Mobile navigation
      const hamburgerBtn = document.getElementById("hamburger-btn");
      const sidebar = document.querySelector(".sidebar");

      if (hamburgerBtn && sidebar) {
        hamburgerBtn.addEventListener("click", () => {
          if (window.innerWidth < 768) {
            sidebar.classList.toggle("mobile-open");
            hamburgerBtn.classList.toggle("mobile-open");
          }
        });
      }

      // Animations
      ScrollReveal().reveal(".subjects-section", { delay: 1000 });
      ScrollReveal().reveal(".subjects-content-wrapper", { delay: 1200 });
      ScrollReveal().reveal(".subjects-list", { delay: 1400 });
      ScrollReveal().reveal(".subject-details", { delay: 1600 });
    </script>
  </body>
</html>
