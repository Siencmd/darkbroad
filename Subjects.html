<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Subjects - Darkboard</title>

    <!-- Main CSS -->
    <link rel="stylesheet" href="Darkboard.css" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"/>

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
    />
  </head>

  <body>
    <div class="app-container">
      <!-- Mobile Sidebar Toggle - Inside app-container for proper z-index -->
      <button id="hamburger-btn" class="hamburger-btn">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <!-- Right Side User Menu -->
      <div class="user-menu-right">
        <img src="Gemini_Generated_Image_g3iakg3iakg3iakg.png" alt="User" class="user-avatar">
        <span id="headerUserName">Ace</span>
      </div>

      <!-- Sidebar Navigation -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <a href="index.html" class="brand">DARKBOARD</a>
        </div>
        <nav class="sidebar-nav">
          <a href="index.html" class="nav-item">
            <i class="fas fa-th-large"></i>
            <span>Dashboard</span>
          </a>
          <a href="Subjects.html" class="nav-item active">
            <i class="fas fa-book"></i>
            <span>Subjects</span>
          </a>
          <a href="Grades.html" class="nav-item">
            <i class="fas fa-chart-bar"></i>
            <span>Grades</span>
          </a>
          <a href="Schedule.html" class="nav-item">
            <i class="fas fa-calendar-alt"></i>
            <span>Schedule</span>
          </a>
          <a href="Announcements.html" class="nav-item">
            <i class="fas fa-bell"></i>
            <span>Announcements</span>
          </a>
          <hr
            style="
              border: 0;
              border-top: 1px solid rgba(255, 255, 255, 0.1);
              margin: 10px 0;
            "
          />
          <a href="Profile.html" class="nav-item">
            <i class="fas fa-user"></i>
            <span>Profile</span>
          </a>
          <a href="Settings.html" class="nav-item">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
          </a>
          <a href="Help.html" class="nav-item">
            <i class="fas fa-question-circle"></i>
            <span>Help</span>
          </a>
          <a href="#" id="logoutBtn" class="nav-item">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </a>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="content">
        <section class="subjects-section">
          <div class="subjects-header">
            <h1>My Subjects</h1>
            <p>Track your school subjects and grades</p>
          </div>

          <!-- Split Layout -->
          <div class="subjects-content-wrapper">
            <!-- Left Sidebar: List -->
            <div class="subjects-sidebar">
              <div class="sidebar-header">
                <h3>Subject List</h3>
                <button id="addSubjectBtn" class="btn-add-mini" title="Add Subject" onclick="showAddSubjectInline()">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
              
              <!-- Inline Add Subject Form -->
              <div id="inlineAddSubjectForm" style="display: none; padding: 15px; background: var(--glass-bg); border: 1px solid var(--glass-border); margin: 10px; border-radius: 10px;">
                <h4 style="color: var(--accent); margin-bottom: 10px;"><i class="fas fa-plus"></i> Add Subject</h4>
                <form onsubmit="return handleAddSubjectInline(event)">
                  <input type="text" id="inlineSubjectName" placeholder="Subject Name" required style="width: 100%; padding: 8px; margin-bottom: 8px; border-radius: 5px; background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); color: var(--text-primary);" />
                  <input type="text" id="inlineTeacherName" placeholder="Teacher" required style="width: 100%; padding: 8px; margin-bottom: 8px; border-radius: 5px; background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); color: var(--text-primary);" />
                  <input type="text" id="inlineSubjectTime" placeholder="Time (e.g. 08:00 AM - 09:30 AM)" required style="width: 100%; padding: 8px; margin-bottom: 8px; border-radius: 5px; background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); color: var(--text-primary);" />
                  <textarea id="inlineSubjectDesc" placeholder="Description" rows="2" style="width: 100%; padding: 8px; margin-bottom: 8px; border-radius: 5px; background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); color: var(--text-primary); resize: vertical;"></textarea>
                  <div style="display: flex; gap: 5px;">
                    <button type="submit" style="flex: 1; padding: 8px; background: var(--accent); border: none; border-radius: 5px; cursor: pointer; color: #000; font-weight: bold;">Save</button>
                    <button type="button" onclick="hideAddSubjectInline()" style="padding: 8px; background: #666; border: none; border-radius: 5px; cursor: pointer; color: #fff;">Cancel</button>
                  </div>
                </form>
              </div>
              
              <div class="subjects-list" id="subjectsList">
                <!-- List items will be injected here -->
              </div>
            </div>

            <!-- Right Panel: Details -->
            <div class="subject-details" id="subjectDetailsPanel">
              <div class="empty-state">
                <i class="fas fa-book-open"></i>
                <p>Select a subject from the list to view details, tasks, assignments, and lessons.</p>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <script type="module" src="firebase.js"></script>
    <script type="module" src="supabase.js"></script>
    <script type="module" src="script.js"></script>
    <script src="https://unpkg.com/scrollreveal"></script>
    <script src="https://unpkg.com/typed.js@3.0.0/dist/typed.umd.js"></script>
    
    <!-- Inline JavaScript for Add Subject (No Module) -->
    <script>
      // Show inline add subject form
      function showAddSubjectInline() {
        var form = document.getElementById('inlineAddSubjectForm');
        if (form) {
          form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }
      }
      
      // Hide inline add subject form
      function hideAddSubjectInline() {
        var form = document.getElementById('inlineAddSubjectForm');
        if (form) {
          form.style.display = 'none';
        }
      }
      
      // Handle add subject form submission
      window.handleAddSubjectInline = function(e) {
        e.preventDefault();
        console.log('handleAddSubjectInline called');
        
        // Get current subjects from localStorage
        let subjects = JSON.parse(localStorage.getItem('subjects'));
        console.log('Current subjects from localStorage:', subjects);
        
        if (!subjects) {
          subjects = [];
          console.log('Created new empty subjects array');
        }
        
        const subject = {
          id: Date.now().toString(),
          name: document.getElementById('inlineSubjectName').value.trim(),
          teacher: document.getElementById('inlineTeacherName').value.trim(),
          time: document.getElementById('inlineSubjectTime').value.trim(),
          description: document.getElementById('inlineSubjectDesc').value.trim(),
          lessons: [],
          tasks: [],
          assignments: [],
          quizzes: []
        };
        
        console.log('New subject to add:', subject);
        subjects.push(subject);
        
        // Save to localStorage
        localStorage.setItem('subjects', JSON.stringify(subjects));
        console.log('Subjects saved to localStorage:', subjects);
        
        // Hide form and clear inputs
        hideAddSubjectInline();
        e.target.reset();
        
        // Reload the page after a short delay
        setTimeout(function() {
          console.log('Reloading page...');
          location.reload();
        }, 300);
        
        console.log('Subject added successfully');
        return false;
      };
    </script>
    
    <script type="module">
      import { logout, initializeSubjects } from "./script.js";

      // Initialize subjects page functionality
      if (typeof initializeSubjects === 'function') {
        initializeSubjects();
        console.log('Subjects page initialized successfully');
      } else {
        console.error('initializeSubjects function not found');
      }

      // Logout button
      const logoutBtn = document.getElementById("logoutBtn");
      logoutBtn.addEventListener("click", (e) => logout(e));

      // Mobile navigation toggle
      const hamburgerBtn = document.getElementById("hamburger-btn");
      const sidebar = document.querySelector(".sidebar");

      console.log("Hamburger button found:", hamburgerBtn);
      console.log("Sidebar found:", sidebar);

      if (hamburgerBtn && sidebar) {
        console.log("Adding hamburger click listener");
        hamburgerBtn.addEventListener("click", () => {
          if (window.innerWidth < 768) {
            console.log("Hamburger clicked, toggling classes");
            sidebar.classList.toggle("mobile-open");
            hamburgerBtn.classList.toggle("mobile-open");
            console.log("Sidebar classes:", sidebar.classList);
            console.log("Hamburger classes:", hamburgerBtn.classList);
          }
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', (e) => {
          if (window.innerWidth < 768 && sidebar && !sidebar.contains(e.target) && !hamburgerBtn.contains(e.target)) {
            const openModal = document.querySelector('.modal[style*="display: block"]') || document.querySelector('.modal.show');
            if (!openModal || !openModal.contains(e.target)) {
              console.log("Clicking outside, closing sidebar");
              sidebar.classList.remove('mobile-open');
              hamburgerBtn.classList.remove('mobile-open');
            }
          }
        });

        // Close sidebar when clicking a nav item on mobile
        const navItems = sidebar.querySelectorAll('.nav-item');
        console.log("Nav items found:", navItems.length);
        navItems.forEach(item => {
          item.addEventListener('click', () => {
            if (window.innerWidth < 768) {
              console.log("Nav item clicked, closing sidebar");
              sidebar.classList.remove('mobile-open');
              hamburgerBtn.classList.remove('mobile-open');
            }
          });
        });
      } else {
        console.log("Hamburger button or sidebar not found");
      }

      // Add animation on the web page using ScrollReveal
      ScrollReveal().reveal(".subjects-section", {
        delay: 1000,
      });

      ScrollReveal().reveal(".subjects-content-wrapper", {
        delay: 1200,
      });

      ScrollReveal().reveal(".subjects-list", {
        delay: 1400,
      });

      ScrollReveal().reveal(".subject-details", {
        delay: 1600,
      });
    </script>

  </body>
</html>
